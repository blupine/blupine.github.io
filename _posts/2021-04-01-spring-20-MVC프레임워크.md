---
layout: post
title:  "[스프링 MVC] MVC 프레임워크 만들기 (1)"
subtitle: ""
date:   2021-04-01 18:33:57 +0900
categories: dev
tags : Spring
---

[base commit]({{"https://github.com/blupine/servlet-practice/commit/c2993fada3f3a5ec0b676eb602642723419e92f9"}})

해당 포스팅에서 작성하는 모든 내용은 위 base commit을 기반으로 해당 repository에 구현됨



## 1. 프론트 컨트롤러 패턴
- 스프링 MVC에서 `DispatcherServlet`과 동일한 포지션(프론트 컨트롤러로 구현됨)
- 게이트웨이가 되는 서블릿, 해당 서블릿에서 모든 요청을 받고 각 요청을 처리할 수 있는 Controller에 request/response 객체를 전달함
- 프론트 컨트롤러를 제외한 나머지 컨트롤러는 서블릿을 사용하지 않아도 됨
- 모든 요청에 대한 공통 처리가 가능함


--------------------------------------------------
### Version1

먼저 모든 Controller들에 공통적으로 적용할 수 있는 인터페이스를 정의해둔다. 모든 컨트롤러는 해당 인터페이스를 구현하도록 한다.

```java
// ControllerV1
public interface ControllerV1 {
    void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException;
}
```

이제 구현할 Controller들을 해당 인터페이스를 구현(implement)하도록 해서 구현해준다.

```java
// MemberFormControllerV1.java
public class MemberFormControllerV1 implements ControllerV1 {

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}
```

모든 컨트롤러들을 위와 같이 `ControllerV1`이라는 공통된 인터페이스를 구현하도록 설계했기 때문에 `FrontController`에서는 해당 인터페이스를 구현하는 모든 컨트롤러에 아래와 같이 다형성을 이용하여 추상화된 코드로 요청을 포워딩해줄 수 있다.

```java
// FrontControllerServletV1.java
@WebServlet(name = "frontControllerServletV1", urlPatterns = "/front-controller/v1/*")
public class FrontControllerServletV1 extends HttpServlet {

    private Map<String, ControllerV1> controllerMap = new HashMap<>();

    // URL - Controller 매핑 정보
    public FrontControllerServletV1() {
        controllerMap.put("/front-controller/v1/members/new-form", new MemberFormControllerV1());
        controllerMap.put("/front-controller/v1/members/save", new MemberSaveControllerV1());
        controllerMap.put("/front-controller/v1/members", new MemberListControllerV1());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String requestURI = req.getRequestURI();
        
        ControllerV1 controller = controllerMap.get(requestURI);  // 다형성을 이용해서 인터페이스 타입으로 컨트롤러들을 받음

        if (controller == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        controller.process(req, resp);
    }
}
```




